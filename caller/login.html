<html lang="en">
<head>
    <title>Shyori</title>

    <!-- BEGIN META -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="your,keywords">
    <meta name="description" content="Short explanation about this website">

    <!-- BEGIN STYLESHEETS -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,300,400,600,700,800' rel='stylesheet' type='text/css'/>
    <link type="text/css" rel="stylesheet" href="../assets/css/theme-2/bootstrap.css" />
    <link type="text/css" rel="stylesheet" href="../assets/css/theme-2/materialadmin.css" />
    <link type="text/css" rel="stylesheet" href="../assets/css/theme-2/material-design-iconic-font.min.css" /> <!--Material Design Iconic Font-->
    <!-- Additional CSS includes -->
    <link rel="stylesheet" href="../assets/css/style.css">

</head>
<body>
<header id="header">
    <div class="headerbar">
        <div class="headerbar-left col-sm-12">
            <ul class="header-nav header-nav-options">
                <li class="header-nav-brand col-xs-6">
                    <div class="brand-holder">
                        <a href="choice.html">
                            <span class="text-lg text-bold">Shyori</span>
                        </a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</header>
<div id="base">
    <div id="content">
        <section>
            <div class="section-body">
                <div class="card style-transparent">
                    <div class="card-body">
                        <form class="form" action="">
                            <div class="form-group">
                                <input type="text" class="form-control" id="username">
                                <label for="username">Username / E-mail</label>
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-control" id="password">
                                <label for="password">Password</label>
                            </div>
                        </form>
                        <button id="login" class="btn btn-lg btn-block btn-primary">Log In</button>
                        <div id="error-message">
                            <p></p>
                        </div>
                        <h6 class="text-center">OR</h6>
                        <a href="signup.html" type="submit" class="btn btn-lg btn-block btn-accent">Create an account</a>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

<!-- BEGIN JAVASCRIPT -->
<script src="../assets/js/libs/jquery/jquery-1.11.2.min.js"></script>
<script src="../assets/js/libs/jquery/jquery-migrate-1.2.1.min.js"></script>
<script src="../assets/js/libs/bootstrap/bootstrap.min.js"></script>

<script>
    $(document).ready(function () {
        var $username=$("#username");
        var $password=$("#password");

        $('#login').click(function () {
            $.ajax(
                    {
                        type:'GET',
                        url:'http://shyori.xcgstudio.com/caller-login/',
                        data:{username:$username.val(),password:$password.val()},
                        dataType:'json',
                        crossDomain:true,
                        jsonpCallback: 'callback',
                        success:function (response){
                            if (response.username===null){
                                $("#error-message").append('<div class="alert alert-danger" role="alert"><strong>Hi! </strong>You entered wrong username or password.Please try again later</div>');
                            }
                            else {
                                console.log(response.username);
                                localStorage.caller_username=response.username;
                                localStorage.caller_id=response.id;
                                localStorage.request_lock=response.request_count[0][0];
                                if(localStorage.request_lock==1){
                                    window.location.href='confirmed-rides.html';
                                }
                                else {
                                    localStorage.request_lock=0;
                                    window.location.href='take-ride.html';
                                }
                            }
                        }
                    }
            );
        });
    });
</script>
</body>
</html>